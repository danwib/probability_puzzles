# Probability Puzzles — Analytic + Monte Carlo (Python)

Well-tested implementations of classic probability puzzles with **analytic solutions**, optional **Monte Carlo cross-checks**, a small **CLI**, and **tests + CI** for reproducibility.

## What’s inside
- **Birthday paradox** — probability of at least one shared birthday in a group of *n*.
- **Coupon collector** — expected trials to collect *n* distinct coupons (exact + harmonic approximation).
- **Bayes PPV/NPV** — positive/negative predictive values for a binary test.
- **Order statistics** — expectations for max and k-th order statistic of Uniform(0,1).
- **Balls in bins** — expected number of empty bins when throwing balls into bins uniformly at random.

Each module includes formulas and reasoning, optional Monte Carlo validation, and unit tests. The CLI prints **JSON** for easy scripting.

---

## Quick start

```bash
# 1) Create a virtualenv (recommended)
python -m venv .venv && source .venv/bin/activate  # Windows: .venv\Scripts\activate

# 2) Install
pip install -r requirements.txt

# 3) Run tests + coverage gate (90%)
pytest --maxfail=1 --disable-warnings --cov=src --cov-report=term-missing --cov-fail-under=90
```

### CLI examples

```bash
# Birthday paradox (analytic only)
python -m src.prob_main birthday --n 23 --days 365

# Birthday paradox with Monte Carlo cross-check
python -m src.prob_main birthday --n 23 --days 365 --mc-trials 5000

# Coupon collector (exact)
python -m src.prob_main coupon --n 50

# Coupon collector (approximation via harmonic numbers)
python -m src.prob_main coupon --n 50 --approx
```

The CLI prints a single JSON object per run, e.g.
```json
{"problem":"birthday","n":23,"days":365,"p_shared":0.507297}
```

### Re-generate the results table

```bash
python -m scripts.emit_results
```
This updates **RESULTS.md** (markdown table) and **results.json** at the repo root.

---

## Results
| Puzzle | Case | Metrics |
|---|---|---|
| Birthday paradox | n=5 | p_shared=0.0271356 |
| Birthday paradox | n=10 | p_shared=0.116948 |
| Birthday paradox | n=20 | p_shared=0.411438 |
| Birthday paradox | n=23 | p_shared=0.507297 |
| Birthday paradox | n=30 | p_shared=0.706316 |
| Birthday paradox | n=50 | p_shared=0.970374 |
| Coupon collector | n=3 | E[T]_exact=5.5, E[T]_approx=5.52748 |
| Coupon collector | n=10 | E[T]_exact=29.2897, E[T]_approx=29.298 |
| Coupon collector | n=20 | E[T]_exact=71.9548, E[T]_approx=71.959 |
| Coupon collector | n=50 | E[T]_exact=224.96, E[T]_approx=224.962 |
| Coupon collector | n=100 | E[T]_exact=518.738, E[T]_approx=518.739 |
| Bayes PPV/NPV | sens=0.9, spec=0.95, prev=0.01 | PPV=0.153846, NPV=0.998938 |
| Bayes PPV/NPV | sens=0.9, spec=0.95, prev=0.1 | PPV=0.666667, NPV=0.988439 |
| Order stats | E[max], n=5 | E[max]=0.833333 |
| Order stats | E[X_(k)], n=5, k=1 | E[X_(k)]=0.166667 |
| Order stats | E[X_(k)], n=5, k=3 | E[X_(k)]=0.5 |
| Order stats | E[X_(k)], n=5, k=5 | E[X_(k)]=0.833333 |
| Order stats | E[max], n=10 | E[max]=0.909091 |
| Order stats | E[X_(k)], n=10, k=1 | E[X_(k)]=0.0909091 |
| Order stats | E[X_(k)], n=10, k=5 | E[X_(k)]=0.454545 |
| Order stats | E[X_(k)], n=10, k=10 | E[X_(k)]=0.909091 |
| Balls in bins | m=10, n=10 | E[empty]=3.48678 |
| Balls in bins | m=20, n=10 | E[empty]=1.21577 |
| Balls in bins | m=100, n=10 | E[empty]=0.000265614 |
| Balls in bins | m=100, n=50 | E[empty]=6.63098 |


> The table above is generated by `python -m scripts.emit_results` to keep it in sync with the code.

---

## Project structure

```
src/
  bayes.py            # PPV/NPV and helpers
  birthday.py         # birthday paradox probability
  coupon_collector.py # exact + approx E[T_n]
  order_stats.py      # E[max], E[X_(k)] for U(0,1)
  balls_bins.py       # expected empty bins
  sim.py              # Monte Carlo helpers
  prob_main.py        # CLI (prints JSON)
tests/                # unit + property tests (includes CLI coverage)
scripts/emit_results.py
RESULTS.md, results.json
```

## Design principles
- **Clarity:** concise docstrings and short derivations where helpful.
- **Verification:** analytic results cross-checked with **Monte Carlo** using fixed seeds.
- **Engineering hygiene:** **pytest**, **Black/isort**, and a **90% coverage gate**.
- **Practicality:** JSON CLI for quick comparisons and automation.

## License
See **LICENSE** for details.
